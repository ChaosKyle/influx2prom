# Grafana Cloud JSON Format

This document explains the Grafana Cloud JSON format used by `influx2prom` and how it's structured for use with Grafana Cloud.

## Format Structure

The Grafana Cloud JSON format generated by `influx2prom` follows this structure:

```json
{
  "name": "dataset_name",
  "data": [
    {
      "metric": "measurement_field",
      "labels": {
        "tag1": "value1",
        "tag2": "value2"
      },
      "points": [
        [timestamp_ms, value],
        [timestamp_ms, value]
      ]
    }
  ]
}
```

Where:
- `name`: The dataset name (configurable with `--dataset-name`)
- `data`: An array of metric series
  - `metric`: The metric name (formed from `measurement_field`)
  - `labels`: Key-value pairs from InfluxDB tags
  - `points`: Array of timestamp-value pairs in millisecond precision

## Example

Here's an example of InfluxDB data converted to Grafana Cloud JSON format:

### InfluxDB CSV:
```
_time,_measurement,_field,_value,host,region
2023-01-01T06:00:00Z,cpu,usage_user,90.5,server01,us-west
2023-01-01T07:00:00Z,cpu,usage_system,91.2,server01,us-west
```

### Grafana Cloud JSON:
```json
{
  "name": "cpu_metrics",
  "data": [
    {
      "metric": "cpu_usage_user",
      "labels": {
        "host": "server01",
        "region": "us-west"
      },
      "points": [
        [1672552800000, 90.5]
      ]
    },
    {
      "metric": "cpu_usage_system",
      "labels": {
        "host": "server01",
        "region": "us-west"
      },
      "points": [
        [1672556400000, 91.2]
      ]
    }
  ]
}
```

## Bulk Processing Format

When using the `--bulk` option with `--input-json`, the input file should be structured as:

```json
[
  {
    "query": "from(bucket:\"system\") |> range(start: -1h) |> filter(fn: (r) => r._measurement == \"cpu\")",
    "dataset_name": "cpu_metrics"
  },
  {
    "query": "from(bucket:\"system\") |> range(start: -1h) |> filter(fn: (r) => r._measurement == \"memory\")",
    "dataset_name": "memory_metrics"
  }
]
```

The output will be an array of results with each query and its converted data:

```json
[
  {
    "dataset_name": "cpu_metrics",
    "query": "from(bucket:\"system\") |> range(start: -1h) |> filter(fn: (r) => r._measurement == \"cpu\")",
    "data": { ... Grafana JSON data ... }
  },
  {
    "dataset_name": "memory_metrics",
    "query": "from(bucket:\"system\") |> range(start: -1h) |> filter(fn: (r) => r._measurement == \"memory\")",
    "data": { ... Grafana JSON data ... }
  }
]
```

## Using with Grafana Cloud

1. Export your InfluxDB data in Grafana JSON format:
   ```bash
   influx2prom --url http://localhost:8086 --token YOUR_TOKEN --org YOUR_ORG --format grafana --dataset-name "cpu_metrics" --query "from(bucket:\"metrics\") |> range(start: -1h)" --output metrics.json
   ```

2. Use the generated JSON file with Grafana Cloud APIs or upload it to your Grafana dashboard.

3. For bulk processing of multiple metrics:
   ```bash
   influx2prom --url http://localhost:8086 --token YOUR_TOKEN --org YOUR_ORG --format grafana --bulk --input-json queries.json --output all_metrics.json
   ```